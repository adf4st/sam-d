# SAM-D Starter App : API

Java Spring API for the MAS-D stack starter application [link to base project](http://google.com).

## Dockerfile
The Dockerfile in the root api directory starts from a base Java:8 image and copies in the API JAR from the api/build/libs directory. The API JAR is generated by running `gradle clean build`. When the container is started it executes `java -jar app.jar` to run the application.

## Security

This JWT auth implementation borrowed heavily from Vladimir Stankovic's wonderful [blog post](http://www.svlada.com/jwt-token-authentication-with-spring-boot/#jwt-authentication) on a JWT + Spring implementation.  
It uses Stormpath's [Java JWT](https://github.com/jwtk/jjwt) under the hood for managing Json Web Tokens.

### Configuration
`WebSecurityConfig` is where security configuration is initialized. It includes the following: 
- Defines authentication and token refresh endpoints
- Autowires and adds the authentication providers which handle token creation and verification

`JwtSettings` pulls configuration values from `application.yml` such as 
- tokenExpirationTime
- refreshTokenExpTime
- tokenIssuer
- tokenSigningKey

### User Login
- `AjaxLoginProcessingFilter` takes username and password from request and returns a Spring-Security Authentication object
- `AjaxAuthenticationProvider` 
    - gets username and password form Authentication object 
    - retrieves User object from `UserRepository`
    - validates password
    - gets user's `GrantedAuthority` list (AKA roles) and adds them to `UserContext`

### Auth Responses
- `AjaxAwareAuthenticationFailureHandler` determines what failed authentication responses look like. It catches auth related exceptions and generates appropriate responses. 
- `AjaxAwareAuthenticationSuccessHandler` creates the tokens (token & refreshToken) and adds them to the response.


#TO DO
 - update bootstrapping code?
 - general code cleanup 
 - dockerize 
 - put on github