# SAM-D Starter App : API

Java Spring Boot API for the SAM-D stack starter application.

## Getting Started
#### Starting the API

1. from the base api directory run, `./gradlew bootRun`

#### Build the API

1. from the base api directory run, `./gradlew clean build`


## Dockerfile
The Dockerfile in the root api directory starts from a base Java:8 image and copies in the API JAR from the api/build/libs directory. The API JAR is generated by running `gradle clean build`. When the container is started it executes `java -jar app.jar` to run the application.  
[Docker Repo](https://hub.docker.com/r/afabian/samd-api/) 

## Security

This JWT auth implementation borrowed largely from Vladimir Stankovic's wonderful [blog post](http://www.svlada.com/jwt-token-authentication-with-spring-boot/#jwt-authentication) on a JWT + Spring implementation.  
It uses Stormpath's [Java JWT](https://github.com/jwtk/jjwt) under the hood for managing Json Web Tokens.

### Configuration
`WebSecurityConfig` is where security configuration is initialized. It includes the following: 
- Defines authentication and token refresh endpoints
- Autowires and adds the authentication providers which handle token creation and verification
- Contains a list of non-authenticated endpoints (see below)

```java
List<String> pathsToSkip = Arrays.asList(UNAITHENTICATED_ENDPOINTS_GO_HERE);
```

`JwtSettings` pulls configuration values from `application.yml` such as 
- tokenExpirationTime
- refreshTokenExpTime
- tokenIssuer
- tokenSigningKey

### User Login
- `AjaxLoginProcessingFilter` takes username and password from request and returns a Spring-Security Authentication object
- `AjaxAuthenticationProvider` 
    - gets username and password form Authentication object 
    - retrieves User object from `UserRepository`
    - validates password
    - gets user's `GrantedAuthority` list (AKA roles) and adds them to `UserContext`

### Auth Responses
- `AjaxAwareAuthenticationFailureHandler` determines what failed authentication responses look like. It catches auth related exceptions and generates appropriate responses. 
- `AjaxAwareAuthenticationSuccessHandler` creates the tokens (token & refreshToken) and adds them to the response.